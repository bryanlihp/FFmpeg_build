Pre-requisites

Visual Studio 2013 or 2015
MSYS2
YASM
Visual Studio

Latest ffmpeg versions compile both with Visual Studio 2013 and 2015. Previous versions don’t compile with VS2015 because they expect that VS compiler has no snprintf support while it was introduced in VS2015.

MSYS2

Download and run the installer at ?http://msys2.github.io. Follow the instructions and install it in C:\workspace\windows\msys64
Install required tools: pacman -S make gcc diffutils
Rename C:\workspace\windows\msys64\usr\bin\link.exe to C:\workspace\windows\msys64\usr\bin\link_orig.exe, in order to use MSVC link.exe (naming conflict)
YASM

Download Win64.exe and move it to C:\workspace\windows
Rename yasm-<version>-win64.exe to yasm.exe
Add C:\workspace\windows to PATH environment variable (setx PATH "%PATH%;C:\workspace\windows)
Ready to compile

Launch msys2 shell from Visual Studio Code shell

Run VS prompt (64 for x64 build  or 32 for x86 build)
Run C:\workspace\windows\msys64\msys_shell.cmd -mingw64 -use-full-path 
OR
Run C:\workspace\windows\msys64\msys_shell.cmd -mingw32 -use-full-path 

Ensure 
which cl exists 
and 
which link points to MSVC
and 
which yasm exists

Assuming path to FFmpeg source code is ../FFmpeg, 

../FFmpeg/configure --prefix=stage --toolchain=msvc --arch=x86 (or amd64 for 64) --enable-yasm --enable-asm --disable-debug --enable-static --extra-cflags='-MT' !!!!--extra-cflags='-MT' is necessary as we want to use Libcmt.lib not msvcrt.lib

../FFmpeg/configure --prefix=stage --toolchain=msvc --arch=x86 --enable-yasm --enable-asm --enable-static --extra-cflags='-MDd'	!!!!!!!!--extra-cflags='-MDd' is necessary as we want to use not msvcrtd.lib, not msvcrt.lib


***With Lame
1. link libmpeghip_static with libmp3lame_static
2. Compile Lame
3. Copy lame.h to include/lame/lame.h
4. rename libm3lame_static.lic to mp3lame.lib
5. compile FFmpeg:

../FFmpeg/configure --prefix=stage --toolchain=msvc --arch=x86 --enable-yasm --enable-asm --disable-debug --enable-static --enable-libmp3lame --extra-cflags='-I"../lame-3.99.5/include"' --extra-ldflags='-LIBPATH:"../lame-3.99.5/output/Release"'
